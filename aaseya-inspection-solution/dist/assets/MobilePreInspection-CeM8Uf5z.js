import{b as P,r as m,S as $,a as W,J as G,j as e,G as u,C as U,T as c,e as f,D as y,B as d,i as _,o as A,u as M}from"./index-CsrR-wrF.js";/* empty css                    *//* empty css                    */import{A as O,a as H}from"./add-notes-m3W-_Glx.js";import{D as J}from"./download-DA--uIhM.js";const V=({preInspectionChecklists:g,inspectionID:a})=>{const b=P(),[i,x]=m.useState([]),[w,p]=m.useState(""),C=m.useRef(0),{snack:q,setSnack:h}=m.useContext($),T=W(),[R,j]=m.useState(!1),S=m.useRef([]),z=G("input")`
        clip: rect(0 0 0 0);
        clip-path: inset(50%);
        height: 1px;
        overflow: hidden;
        position: absolute;
        bottom: 0;
        left: 0;
        white-space: nowrap;
        width: 1px;
    `;m.useEffect(()=>{x(g==null?void 0:g.preInspectionChecklist)},[g]);const D=(n,l)=>{x(r=>r.map(s=>{var o;return s.name===l.name?{...s,attachments:((o=s.attachments)==null?void 0:o.length)>0?[...s.attachments,n.target.files[0]]:[n.target.files[0]]}:s}))},B=(n,l)=>{x(r=>r==null?void 0:r.map(s=>s.name===l.name?{...s,comment:n.target.value}:s))},E=(n,l)=>{var r;x(s=>s==null?void 0:s.map(o=>o.name===n.name?{...o,selected_answers:l}:o)),(r=S.current)!=null&&r.includes(n==null?void 0:n.id)||(S.current.push(n==null?void 0:n.id),C.current=parseInt(C.current)+1)},L=n=>URL.createObjectURL(n),I=async n=>{var l,r;try{j(!0);let s=[];if((l=i==null?void 0:i.preInspectionChecklist)==null||l.forEach(t=>{s.push({id:{inspectionid:a,preinspectionchecklistid:t==null?void 0:t.id},name:t==null?void 0:t.name,selected_answers:t==null?void 0:t.selected_answers,comment:(t==null?void 0:t.comment)||""})}),!s.length){console.error("No checklist data to submit"),h({open:!0,message:"No checklist data available for submission.",severity:"error"}),j(!1);return}const o=await A({method:"post",url:"http://52.140.64.177:9090/saveSubmitPreInspection",data:{saveSubmitPreInspectionChecklist:s,inspectionID:a,action:n}});((r=o==null?void 0:o.data)==null?void 0:r.status)==="Failure"?h({open:!0,message:"Something went wrong. Please try again later.",severity:"error"}):(n==="save"&&h({open:!0,message:"Pre Inspection Saved successfully.",severity:"success"}),n==="submit"&&(h({open:!0,message:"Pre Inspection submitted successfully.",severity:"success"}),T("/cases"))),j(!1)}catch(s){console.log(s),j(!1)}};return e.jsx(e.Fragment,{children:e.jsxs(u,{container:!0,children:[R&&e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:50},children:e.jsx(u,{container:!0,sx:{"& .MuiCircularProgress-root":{color:"#00000029"},justifyContent:"center",alignItems:"center"},children:e.jsx(U,{size:160,thickness:2,color:"grey"})})}),e.jsxs(u,{container:!0,sx:{marginTop:"48px",backgroundColor:"#F2F6F6",height:"95vh"},children:[e.jsxs(u,{container:!0,size:12,direction:"column",sx:{marginLeft:"24px",width:"100%",pt:4},children:[e.jsx(c,{fontWeight:700,children:"Pre Inspection Checklist"}),e.jsxs(c,{fontWeight:500,children:[C.current,"/",i==null?void 0:i.length," Completed"]})]}),e.jsxs(u,{container:!0,className:"categoryChecklistContainer",sx:{border:"none"},children:[i==null?void 0:i.map((n,l)=>{var r,s,o;return e.jsxs(e.Fragment,{children:[e.jsxs(u,{container:!0,children:[e.jsx(u,{container:!0,sx:{fontSize:"14px",textAlign:"justify",mb:2,mt:3},children:e.jsx(c,{className:"typographyFontWeight",children:n.name})}),e.jsx(u,{container:!0,direction:"column",rowGap:1,sx:{width:"100%",display:"flex",alignItems:"center",mb:2},children:(r=n.answerType)==null?void 0:r.split("/").map((t,N)=>e.jsx(f,{variant:"outlined",className:"choiceButton",fullWidth:!0,sx:{backgroundColor:(n==null?void 0:n.selected_answers)===t?b.palette.colors[20]:"",fontWeight:(n==null?void 0:n.answer)===t?700:""},onClick:()=>E(n,t),children:t},t+N))})]},n==null?void 0:n.id),e.jsx(y,{sx:{my:1,width:"100%"}}),e.jsxs(d,{display:"flex",className:"mobileAttachmentContainer ",children:[e.jsx(d,{className:"attchmentsContainer",children:e.jsxs(f,{component:"label",role:void 0,tabIndex:-1,sx:{fontWeight:500,color:"black",fontSize:14,height:"25px"},startIcon:e.jsx(O,{sx:{fontSize:12}}),children:[e.jsx(z,{type:"file",accept:"image/*",onChange:t=>{D(t,n)}}),"Attach Image"]})}),e.jsxs(d,{className:"attchmentsContainer",onClick:()=>p(`note${n.id}`),children:[e.jsx("img",{src:H,alt:"Add notes"}),e.jsx(c,{ml:1,className:"typographyFontWeight",children:"Add Notes"})]})]}),e.jsx(y,{sx:{my:1,width:"100%"}}),((s=n==null?void 0:n.attachments)==null?void 0:s.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{children:[e.jsx(c,{className:"headingFontWeight",children:"Documents"}),e.jsx(d,{className:"attachmentContainer",children:(o=n==null?void 0:n.attachments)==null?void 0:o.map((t,N)=>{var v,F;return e.jsxs(d,{className:"attachmentItem",children:[e.jsxs(d,{className:"imageContainer",children:[e.jsx("img",{src:L(t),alt:t.name,className:"attchmentImage"}),e.jsx(c,{className:"attachmentTextStyle",children:((v=t.name)==null?void 0:v.length)>10?((F=t.name)==null?void 0:F.slice(0,9))+"...":t.name})]}),e.jsx(d,{className:"imageDownload",children:e.jsx("img",{src:J,alt:"Download"})})]},N)})})]}),e.jsx(y,{sx:{my:1,width:"100%"}})]}),((n==null?void 0:n.comment)||w===`note${n.id}`)&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{width:"100%",children:[e.jsx(c,{className:"headingFontWeight",children:"Note"}),e.jsx(_,{size:"small",fullWidth:!0,disabled:localStorage.getItem("userRole")!=="INSPECTOR",rows:2,className:"multilineInput",multiline:!0,value:n==null?void 0:n.comment,onChange:t=>B(t,n)})]}),e.jsx(y,{sx:{my:1,width:"100%"}})]})]})}),e.jsxs(u,{container:!0,size:12,rowGap:1,sx:{padding:"16px 0",alignItems:"flex-end",p:2,pb:5},children:[e.jsx(f,{variant:"outlined",className:"saveButton",fullWidth:!0,onClick:()=>{I("save")},children:"Save"}),e.jsx(f,{className:"nextSubmitButton",onClick:()=>{I("submit")},fullWidth:!0,children:"Submit"})]})]})]})]})})},k=()=>{var x;P();const a=(x=M().state)==null?void 0:x.caseDetails,[b,i]=m.useState([]);return W(),m.useEffect(()=>{const w=async()=>{const p=await A({method:"get",url:`http://52.140.64.177:9090/savedPreInspection?inspectionid=${a==null?void 0:a.inspectionID}`});i(p==null?void 0:p.data)};a!=null&&a.inspectionID&&w()},[a==null?void 0:a.inspectionID]),e.jsx(e.Fragment,{children:e.jsx(d,{children:e.jsx(V,{preInspectionChecklists:b,inspectionID:a==null?void 0:a.inspectionID})})})};export{k as default};
