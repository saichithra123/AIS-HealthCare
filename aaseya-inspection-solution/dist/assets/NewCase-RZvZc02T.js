import{u as xe,a as he,b as ge,r as i,S as je,d as ye,Q as fe,j as e,G as c,B as N,C as Ce,T as m,f as be,A as Ne,g as Ie,k as P,i as h,D as k,P as Se,e as H,l as ve,m as U,N as q,I as J,U as Fe,o as I}from"./index-CsrR-wrF.js";import"./index.modern-B3mHbnex.js";/* empty css            */import{A as we}from"./PlaylistAddOutlined-CpSMRKtR.js";import{C as Te}from"./Check-cGaUIAku.js";import{C as De}from"./Close-CoWB75cj.js";const Ye=()=>{var B,R,Y,L,O;const S=xe(),$=he(),g=ge(),z=(B=S.state)==null?void 0:B.inspectionType,[E,Q]=i.useState((R=S.state)!=null&&R.isCreateEntity?(Y=S.state)==null?void 0:Y.isCreateEntity:!1),[K,V]=i.useState([]),[X,Z]=i.useState([]),[v,ee]=i.useState([]),[te,W]=i.useState([]),{snack:Pe,setSnack:C}=i.useContext(je),[o,F]=i.useState({inspectionDate:ye(Date()),inspectionType:z,inspectionReason:"",template:""}),[a,j]=i.useState({entityName:"",buildingName:"",entityArea:"",address:"",entityId:""}),[se,M]=i.useState(!1),n=(L=S.state)!=null&&L.newEntityAddress?JSON.parse((O=S.state)==null?void 0:O.newEntityAddress):null,{header:$e,setHeader:ae}=i.useContext(fe),[x,ne]=i.useState([]),[oe,w]=i.useState(!1),[u,_]=i.useState([]),[T,ze]=i.useState([]);i.useEffect(()=>{ae("Create Case")},[]),i.useEffect(()=>{(async()=>{const s=await I({method:"get",url:"http://52.140.64.177:9090/getInspectionTypeNames"});V(s==null?void 0:s.data)})()},[]),i.useEffect(()=>{if(n!=null&&n.name&&(v==null?void 0:v.find(s=>s===(n==null?void 0:n.name)))){C({open:!0,message:"Entity already exists in the system.",severity:"error"});return}j({entityName:n!=null&&n.name?n==null?void 0:n.name:"",address:n!=null&&n.formatted_address?n==null?void 0:n.formatted_address:"",buildingName:"",entityArea:"",entityId:""})},[n]);const ie=async()=>{var t,s,r;try{if(!(o!=null&&o.inspectionType)){C({open:!0,message:"Please select an inspection type.",severity:"error"});return}const p=(t=X.find(d=>`${d.template_name}: ${d.version}`===o.template))==null?void 0:t.template_id,y=new Date(o.inspectionDate).getFullYear(),f=String(new Date(o.inspectionDate).getMonth()+1).padStart(2,"0"),l=String(new Date(o.inspectionDate).getDate()).padStart(2,"0"),D=`${y}-${f}-${l}`,ce=new Date().getFullYear(),de=String(new Date().getMonth()+1).padStart(2,"0"),ue=String(new Date().getDate()).padStart(2,"0"),pe=`${ce}-${de}-${ue}`,A=[],G=[];x==null||x.map(d=>{u.includes(d==null?void 0:d.name)&&(d!=null&&d.id)&&A.push(d)}),T==null||T.map(d=>{u!=null&&u.includes(d)&&G.push(d)});const me=u.length>0;M(!0);const b=await I.post("http://52.140.64.177:9090/startAISProcess",{inspectionType:o.inspectionType,reason:o.inspectionReason,dateOfInspection:D,createdBy:localStorage.getItem("userEmail"),templateId:p,entityId:a.entityId,status:"new",inspectionSource:"Adhoc",addEntity:E,newEntity:{name:a==null?void 0:a.entityName,address:a==null?void 0:a.address,location:a==null?void 0:a.address,facility:a==null?void 0:a.entityArea,floor:"",building:a==null?void 0:a.buildingName},pre_Inspection_Checklists:A,custom_pre_inspection_checklist:G,createdDate:pe,is_preinspection:me,is_preinspection_submitted:!1});((s=b==null?void 0:b.data)==null?void 0:s.status)==="Failure"?C({open:!0,message:"Something went wrong. Please try again.",severity:"error"}):((r=b==null?void 0:b.data)==null?void 0:r.status)==="Success"?C({open:!0,message:"Inspection Created successfully.",severity:"success"}):C({open:!0,message:"Unexpected response from server.",severity:"warning"}),M(!1),$("/cases")}catch(p){console.log(p),C({open:!0,message:"Something went wrong.",severity:"error"})}};i.useEffect(()=>{const t=async()=>{var r,p,y,f,l;const s=await I({method:"get",url:`http://52.140.64.177:9090/getAddressByEntity/${a.entityName}`});j({...a,buildingName:`${(r=s==null?void 0:s.data)==null?void 0:r.floor}, ${(p=s==null?void 0:s.data)==null?void 0:p.building}`,entityArea:(y=s==null?void 0:s.data)==null?void 0:y.location,address:(f=s==null?void 0:s.data)==null?void 0:f.address,entityId:(l=s==null?void 0:s.data)==null?void 0:l.entityId})};a.entityName&&!E&&t()},[a.entityName]);const re=()=>{Q(!0),$("/cases/create-entity",{state:{isCreateEntity:!0,inspectionType:z}})};i.useEffect(()=>{(async()=>{var y,f;const[s,r,p]=await Promise.all([I.get("http://52.140.64.177:9090/getEntityNames"),I.get(`http://52.140.64.177:9090/getTemplate/${o.inspectionType}`),I.get(`http://52.140.64.177:9090/getAllPreInspectionChecklists?name=${o.inspectionType}`)]);ee((y=s==null?void 0:s.data)==null?void 0:y.map(l=>l==null?void 0:l.name)),Z(r==null?void 0:r.data),(f=r==null?void 0:r.data)==null||f.map(l=>{W(D=>[...D,`${l==null?void 0:l.template_name}: ${l==null?void 0:l.version}`])}),ne(p==null?void 0:p.data)})()},[o.inspectionType]);const le=(t,s)=>{t.target.checked?_(r=>[...r,s]):_(u==null?void 0:u.filter(r=>r!==s))};return e.jsx(e.Fragment,{children:e.jsxs(c,{container:!0,sx:{backgroundColor:"#F2F6F6",opacity:1,height:"92vh"},children:[e.jsxs(N,{sx:{borderRadius:"11px",border:"1px solid #DFDFDF",background:`${g.palette.colors[1]} 0% 0% no-repeat padding-box`,my:11,mx:2,px:2,py:2,boxShadow:`inset 0px 0px 6px ${g.palette.colors[3]}`,opacity:1,height:"80vh",overflow:"auto",scrollbarWidth:"none","& .MuiTypography-root":{fontSize:"12px",color:g.palette.colors[21]}},children:[se&&e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:50},children:e.jsx(c,{container:!0,sx:{"& .MuiCircularProgress-root":{color:"#00000029"},justifyContent:"center",alignItems:"center"},children:e.jsx(Ce,{size:160,thickness:2,color:"grey"})})}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{size:14,sx:{"& .MuiInputBase-root":{height:"37px"}},children:[e.jsxs(m,{children:["Inspection Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(be,{dateAdapter:Ne,children:e.jsx(Ie,{size:"small",format:"DD MMM YYYY",value:o.inspectionDate,onChange:t=>{F({...o,inspectionDate:t})},className:"newCaseFields",sx:{width:"100%",height:"40px"},fullWidth:!0,required:!0})})]}),e.jsxs(c,{size:12,children:[e.jsxs(m,{children:["Inspection Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(P,{disablePortal:!0,id:"combo-box-demo",size:"small",options:K,fullWidth:!0,onChange:(t,s)=>{W([]),F({...o,inspectionType:s})},className:"newCaseFields",value:o.inspectionType,renderInput:t=>e.jsx(h,{...t})})]}),e.jsxs(c,{size:12,children:[e.jsxs(m,{children:["Reason for Inspection ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{size:"small",fullWidth:!0,value:o.inspectionReason,className:"newCaseFields",onChange:t=>{F({...o,inspectionReason:t.target.value})}})]}),e.jsxs(c,{size:12,children:[e.jsxs(m,{children:["Choose Template ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(P,{disablePortal:!0,id:"combo-box-demo",size:"small",options:te,fullWidth:!0,value:o.template,className:"newCaseFields",onChange:(t,s)=>{F({...o,template:s})},renderInput:t=>e.jsx(h,{...t})})]})]}),e.jsx(k,{sx:{my:3}}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{size:12,children:[e.jsx(m,{children:"Entity Name"}),n!=null&&n.name?e.jsx(h,{fullWidth:!0,size:"small",className:"newCaseFields",value:a.entityName,onChange:t=>{j({...a,entityName:t.target.value})}}):e.jsx(P,{disablePortal:!0,id:"combo-box-demo",size:"small",className:"newCaseFields",slotProps:{paper:{component:({children:t,...s})=>e.jsxs(Se,{...s,children:[e.jsx(H,{fullWidth:!0,sx:{justifyContent:"flex-start",pl:2,color:"black"},onMouseDown:re,startIcon:e.jsx(ve,{}),children:"Create New"}),t]})}},value:a.entityName,onChange:(t,s)=>{j({...a,entityName:s})},options:v,fullWidth:!0,renderInput:t=>e.jsx(h,{...t})})]}),e.jsxs(c,{size:12,children:[e.jsx(m,{children:"Floor Number/ Building Name"}),e.jsx(h,{size:"small",fullWidth:!0,value:a.buildingName,className:"newCaseFields",onChange:t=>{j({...a,buildingName:t.target.value})}})]}),e.jsxs(c,{size:12,children:[e.jsx(m,{children:"Area/ Facility"}),e.jsx(h,{size:"small",fullWidth:!0,value:a.entityArea,className:"newCaseFields",onChange:t=>{j({...a,entityArea:t.target.value})}})]}),e.jsxs(c,{size:12,children:[e.jsx(m,{children:"Address"}),e.jsx(h,{size:"small",fullWidth:!0,value:a.address,className:"newCaseFields",onChange:t=>{j({...a,address:t.target.value})}})]})]}),e.jsxs(c,{container:!0,sx:{"& .MuiButtonBase-root:hover":{backgroundColor:g.palette.colors[11]},justifyContent:"flex-end",my:3},children:[(localStorage.getItem("userRole")==="MANAGER"||localStorage.getItem("userRole")==="INSPECTOR")&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{container:!0,children:[e.jsx(m,{mb:1,children:"Pre Inspection Checklist "}),(x==null?void 0:x.length)>0&&(x==null?void 0:x.map((t,s)=>e.jsx(N,{sx:{border:`1px solid${g.palette.colors[22]}`,borderRadius:"20px",opacity:1,width:"100%",px:3,mb:.6,"& .MuiTypography-root":{color:g.palette.colors[6]}},children:e.jsx(U,{control:e.jsx(q,{checked:u==null?void 0:u.includes(t==null?void 0:t.name)}),label:t==null?void 0:t.name,onChange:r=>le(r,t==null?void 0:t.name)})},s))),oe&&e.jsx(e.Fragment,{children:e.jsxs(N,{width:"100%",children:[e.jsxs(N,{className:"preInspectionContainer",children:[e.jsx(U,{control:e.jsx(q,{sx:{pr:0}})}),e.jsx(h,{size:"small",fullWidth:!0,className:"preInspectionField",value:preInspection,onChange:t=>setPreInspection(t.target.value)})]}),e.jsxs(N,{className:"preInspectionIconContainer",children:[e.jsx(J,{onClick:()=>w(!1),children:e.jsx(De,{sx:{color:"#d54b4b",fontWeight:"bold"}})}),e.jsx(J,{onClick:()=>{updatePreInspection(),w(!1)},children:e.jsx(Te,{sx:{color:"#03911a",fontWeight:"bold"}})})]})]})})]}),e.jsx(k,{sx:{mt:.5,mb:1}}),e.jsxs(N,{className:"addPreInspectionContainer",sx:{width:"100%"},onClick:()=>{setPreInspection(""),w(!0)},mt:1,children:[e.jsx(we,{sx:{mr:1}}),e.jsx(m,{className:"typographyFontWeight",children:"Add Pre Inspection"})]})]}),e.jsx(H,{sx:{backgroundColor:g.palette.colors[11],textTransform:"none",borderRadius:"20px",width:"100%",height:"40px",mt:2},onClick:ie,children:"Create Case"})]})]}),e.jsx(Fe,{})]})})};export{Ye as default};
