import{b as ee,a as ae,u as te,r as g,S as se,R as re,j as e,B as c,T as h,e as E,K as oe,D as F,L as ie,G as y,i as k,F as A,h as $,M as m,a5 as W,a6 as de,aG as N,aH as le,o as B}from"./index-CsrR-wrF.js";import{A as ne}from"./PlaylistAddOutlined-CpSMRKtR.js";import{C as pe}from"./Check-cGaUIAku.js";import{C as xe}from"./Close-CoWB75cj.js";/* empty css                    */import{G as ce}from"./GridToolbarContainer-BVoBlSP0.js";import{G as P}from"./GridActionsCellItem-uDNmMIfu.js";const we=()=>{var z;const i=ee(),D=ae(),f=(z=te().state)==null?void 0:z.checklistItemId,[a,C]=g.useState({checklistName:"",severity:"",weightage:"",answerType:"",predefinedAnswerType:""}),[l,G]=g.useState([]),_=g.useRef([]),[j,b]=g.useState({}),[H,S]=g.useState(!1),{snack:he,setSnack:R}=g.useContext(se),L=[{field:"option",headerName:"Answer Options",flex:1},{field:"table",headerName:"Table",flex:1}],O=[{field:"correctiveAction",headerName:"Corrective Actions",flex:1,editable:!0,renderEditCell:t=>e.jsx(U,{...t})},{field:"action",type:"actions",headerName:"Actions",flex:.2,getActions:({id:t})=>{var d;return((d=j[t])==null?void 0:d.mode)===N.Edit?[e.jsx(P,{icon:e.jsx(xe,{sx:{color:"#d54b4b",fontWeight:"bold"}}),label:"Cancel",sx:{color:"primary.main"},onClick:X(t)}),e.jsx(P,{icon:e.jsx(pe,{sx:{color:"#03911a",fontWeight:"bold"}}),label:"Save",className:"textPrimary",onClick:Q(t),color:"inherit"})]:[e.jsx(E,{sx:{color:`${i.palette.colors[11]}`},onClick:()=>J(t),children:"Edit"})]}}],U=t=>{const{id:s,field:d,value:p,api:n}=t,o=x=>{n.setEditCellValue({id:s,field:d,value:x.target.value})};return e.jsx(k,{size:"small",sx:{mt:.5,ml:.5},fullWidth:!0,className:"tableFields",value:p,onChange:o})},V=re.memo(t=>{const{setCorrectiveActions:s,setRowModesModel:d}=t,p=()=>{const n=l==null?void 0:l.reduce((o,x)=>Math.max(o,x.id),0);s(o=>[{id:n+1,correctiveAction:"",isNew:!0},...o]),d(o=>({...o,[n+1]:{mode:N.Edit,fieldToFocus:"correctiveAction"}}))};return e.jsx(ce,{children:e.jsxs(c,{className:"addButtonContainer",mb:1,onClick:p,children:[e.jsx(ne,{sx:{mr:1}}),e.jsx(h,{className:"typographyFontWeight",children:"Add Corrective Actions"})]})})}),K=t=>{b(t)},Y=(t,s)=>{t.reason===le.rowFocusOut&&(s.defaultMuiPrevented=!0)},q=t=>{const s={...t,isNew:!1};return G(l.map(d=>d.id===t.id?s:d)),s},J=t=>{b({...j,[t]:{mode:N.Edit}})},Q=t=>()=>{b({...j,[t]:{mode:N.View}})},X=t=>()=>{b({...j,[t]:{mode:N.View,ignoreModifications:!0}}),G(l.filter(s=>(s==null?void 0:s.id)!==t))};g.useEffect(()=>{f&&(async()=>{var d,p,n,o,x,w,M,v;const s=await B({method:"get",url:`http://52.140.64.177:9090/checklistItemsBy/${f}`});C({checklistName:(d=s==null?void 0:s.data)==null?void 0:d.checklist_name,severity:(p=s==null?void 0:s.data)==null?void 0:p.severity,weightage:(n=s==null?void 0:s.data)==null?void 0:n.weightage,answerType:(o=s==null?void 0:s.data)==null?void 0:o.answer_type,predefinedAnswerType:(x=s==null?void 0:s.data)==null?void 0:x.pre_defined_answer_type}),(M=(w=s==null?void 0:s.data)==null?void 0:w.correctiveactions)==null||M.map(u=>{const T={id:u==null?void 0:u.corrective_action_id,correctiveAction:u==null?void 0:u.corrective_action_name};G(r=>[T,...r])}),_.current=(v=s==null?void 0:s.data)==null?void 0:v.correctiveactions})()},[f]);const Z=async()=>{var t,s,d,p;S(!0);try{const n=l==null?void 0:l.map(x=>x==null?void 0:x.correctiveAction),o=await B({method:"post",url:"http://52.140.64.177:9090/addCheckListItems",data:{checklist_name:a==null?void 0:a.checklistName,severity:a==null?void 0:a.severity,weightage:a==null?void 0:a.weightage,answer_type:a==null?void 0:a.answerType,pre_defined_answer_type:a==null?void 0:a.predefinedAnswerType,isActive:!0,selected_answer:"",selected_corrective_action:n}});((s=(t=o==null?void 0:o.data)==null?void 0:t.status)==null?void 0:s.toUpperCase())==="SUCCESS"?(R({open:!0,message:(d=o==null?void 0:o.data)==null?void 0:d.message,severity:"success"}),D("/checklist-management/items")):R({open:!0,message:(p=o==null?void 0:o.data)==null?void 0:p.message,severity:"error"})}catch(n){console.log(n)}finally{S(!1)}},I=async()=>{var x,w,M,v,u,T;S(!0);const t=l==null?void 0:l.map(r=>r==null?void 0:r.id),s=(x=_.current)==null?void 0:x.filter(r=>t==null?void 0:t.includes(r==null?void 0:r.corrective_action_id)),d=s==null?void 0:s.map(r=>r==null?void 0:r.corrective_action_id),p=(w=_.current)==null?void 0:w.map(r=>r==null?void 0:r.corrective_action_id),n=t==null?void 0:t.filter(r=>!(p!=null&&p.includes(r)));let o=[];l==null||l.map(r=>{n!=null&&n.includes(r==null?void 0:r.id)&&o.push(r==null?void 0:r.correctiveAction)});try{const r=await B({method:"post",url:`http://52.140.64.177:9090/updateChecklistItem/${f}`,data:{checklistName:a==null?void 0:a.checklistName,severity:a==null?void 0:a.severity,weightage:a==null?void 0:a.weightage,answerType:a==null?void 0:a.answerType,predefinedAnswerTypes:a==null?void 0:a.predefinedAnswerType,correctiveActions:d,newCorrectiveActions:o}});((v=(M=r==null?void 0:r.data)==null?void 0:M.status)==null?void 0:v.toUpperCase())==="SUCCESS"?(R({open:!0,message:(u=r==null?void 0:r.data)==null?void 0:u.message,severity:"success"}),D("/checklist-management/items")):R({open:!0,message:(T=r==null?void 0:r.data)==null?void 0:T.message,severity:"error"})}catch(r){console.log(r)}finally{S(!1)}};return e.jsx(e.Fragment,{children:e.jsxs(c,{sx:{borderRadius:"20px",background:`${i.palette.colors[2]} 0% 0% no-repeat padding-box`,my:2,mr:2,p:2.5,boxShadow:`inset 0px 0px 6px ${i.palette.colors[3]}`,opacity:1},children:[e.jsx(E,{sx:{color:i.palette.colors[21],fontSize:"14px",fontWeight:600},startIcon:e.jsx(oe,{}),onClick:()=>D(-1),children:"Back"}),e.jsxs(c,{sx:{background:`${i.palette.colors[1]} 0% 0% no-repeat padding-box`,borderRadius:"10px",opacity:1},children:[e.jsx(c,{sx:{py:2,px:2.5},children:e.jsxs(h,{variant:"h4",fontWeight:600,children:[f?"Edit":"Add"," Checklist Item"]})}),e.jsx(F,{}),e.jsxs(c,{sx:{py:2,px:2.5,"& .MuiTypography-root":{fontSize:"12px",color:i.palette.colors[21]}},children:[H&&e.jsx(ie,{}),e.jsxs(y,{container:!0,spacing:3,children:[e.jsxs(y,{size:4,children:[e.jsxs(h,{children:["Checklist Name",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(k,{size:"small",className:"inputFields",fullWidth:!0,value:a==null?void 0:a.checklistName,onChange:t=>C({...a,checklistName:t.target.value})})]}),e.jsxs(y,{size:4,children:[e.jsxs(h,{children:["Severity",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(A,{fullWidth:!0,className:"inputFields",children:e.jsxs($,{value:a==null?void 0:a.severity,onChange:t=>C({...a,severity:t.target.value}),sx:{"& .MuiSelect-select":{padding:"9px 0 9px 20px"}},children:[e.jsx(m,{value:"High",children:"High"}),e.jsx(m,{value:"Medium",children:"Medium"}),e.jsx(m,{value:"Low",children:"Low"})]})})]}),e.jsxs(y,{size:4,children:[e.jsxs(h,{children:["Weightage",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(k,{size:"small",fullWidth:!0,className:"inputFields",value:a==null?void 0:a.weightage,onChange:t=>C({...a,weightage:t.target.value}),sx:{height:"38px"}})]}),e.jsxs(y,{size:4,children:[e.jsxs(h,{children:["Answer Type",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(A,{fullWidth:!0,className:"inputFields",children:e.jsxs($,{labelId:"selection-type-label",value:a==null?void 0:a.answerType,onChange:t=>C({...a,answerType:t.target.value}),sx:{"& .MuiSelect-select":{padding:"9px 0 9px 20px"}},children:[e.jsx(m,{value:"Predefined",children:"Predefined"}),e.jsx(m,{value:"Custom",children:"Custom"})]})})]}),(a==null?void 0:a.answerType)==="Predefined"&&e.jsxs(y,{size:4,children:[e.jsx(h,{variant:"body2",ml:1,children:"Pre-defined Answer Types"}),e.jsx(A,{fullWidth:!0,className:"inputFields",children:e.jsxs($,{labelId:"predefined-value-label",value:a==null?void 0:a.predefinedAnswerType,onChange:t=>C({...a,predefinedAnswerType:t.target.value}),sx:{"& .MuiSelect-select":{padding:"9px 0 9px 20px"}},children:[e.jsx(m,{value:"Yes/No/NA",children:"Yes/ No/ NA"}),e.jsx(m,{value:"Compliant/Non-Compliant/NA",children:"Compliant/ Non-Compliant/ NA"}),e.jsx(m,{value:"Good/Fair/Poor/NA",children:"Good/ Fair/ Poor/ NA"}),e.jsx(m,{value:"Range 1-5",children:"Range 1-5"})]})})]})]}),e.jsx(F,{sx:{my:2}}),(a==null?void 0:a.answerType)==="Custom"&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[e.jsx(h,{sx:{fontSize:"14px",color:i.palette.colors[21],mb:1},children:"Answer Options"}),e.jsxs(c,{sx:{py:2,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(c,{sx:{maxHeight:"400px",".MuiDataGrid-columnHeader":{backgroundColor:`${i.palette.colors[18]}`},".MuiDataGrid-root":{borderRadius:"10px 10px 0px 0px",border:"0px !important",borderColor:"white !important","--DataGrid-rowBorderColor":"#ffffff"},".MuiDataGrid-main":{borderRadius:"10px 10px 0px 0px"},"& .MuiDataGrid-columnsContainer, .MuiDataGrid-cell":{borderBottom:"0px !important",borderTop:"0px !important"}," .MuiDataGrid-row":{border:`1px solid ${i.palette.colors[22]}`,borderRadius:"6px",my:"1px"}," .MuiDataGrid-overlay":{border:`1px solid ${i.palette.colors[22]}`,borderRadius:"6px",my:"1px"},".MuiDataGrid-selectedRowCount":{display:"none"}},children:e.jsx(W,{columns:L,rows:[],checkboxSelection:!0,hideFooter:!0,autoHeight:!0,disableRowSelectionOnClick:!0})}),e.jsx(de,{pageCount:5})]})]}),e.jsx(F,{sx:{my:2}})]}),e.jsx(h,{sx:{fontSize:"14px",color:i.palette.colors[21],mb:1},children:"Corrective Actions"}),e.jsx(c,{sx:{py:2,display:"flex",flexDirection:"column",gap:1},children:e.jsx(c,{sx:{height:"400px",".MuiDataGrid-columnHeader":{backgroundColor:`${i.palette.colors[18]}`},".MuiDataGrid-root":{borderRadius:"10px 10px 0px 0px",border:"0px !important",borderColor:"white !important","--DataGrid-rowBorderColor":"#ffffff"},".MuiDataGrid-main":{borderRadius:"10px 10px 0px 0px"},"& .MuiDataGrid-columnsContainer, .MuiDataGrid-cell":{borderBottom:"0px !important",borderTop:"0px !important"}," .MuiDataGrid-row":{border:`1px solid ${i.palette.colors[22]}`,borderRadius:"6px",my:"1px"}," .MuiDataGrid-overlay":{border:`1px solid ${i.palette.colors[22]}`,borderRadius:"6px",my:"1px"},".MuiDataGrid-columnHeaders .MuiDataGrid-scrollbarFiller":{backgroundColor:`${i.palette.colors[18]}`}," .MuiDataGrid-scrollbar":{display:"none"},".MuiDataGrid-footerContainer":{borderTop:"0px"}},children:e.jsx(W,{columns:O,rows:l,getRowId:t=>t==null?void 0:t.id,hideFooter:!0,slots:{toolbar:V},slotProps:{toolbar:{setCorrectiveActions:G,setRowModesModel:b}},editMode:"row",rowModesModel:j,onRowModesModelChange:K,onRowEditStop:Y,processRowUpdate:q})})}),e.jsx(c,{sx:{"& .MuiButtonBase-root:hover":{backgroundColor:i.palette.colors[11]}},children:e.jsx(E,{mt:3,sx:{backgroundColor:i.palette.colors[11],textTransform:"none",borderRadius:"20px",width:"100px",height:"40px",display:"flex",marginLeft:"auto"},onClick:()=>f?I():Z(),children:"Submit"})})]})]})]})})};export{we as default};
