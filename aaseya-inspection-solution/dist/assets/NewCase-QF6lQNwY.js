import{c as L,j as e,u as xe,a as me,b as he,r,S as ge,d as _,R as je,B as w,e as T,K as pe,T as u,D as Y,L as fe,G as i,f as Ce,A as ye,g as Se,F as q,h as H,M as B,i as I,k as J,P as be,l as Ie,I as ve,m as we,n as Ne,o as f}from"./index-CsrR-wrF.js";import{G as Me}from"./GoogleMap-CEX4WJJD.js";import{R as ze,C as Fe}from"./CustomRadio-DaMEwieZ.js";import"./index.modern-B3mHbnex.js";/* empty css            */const Pe=L(e.jsx("path",{d:"M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47M6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47m1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93"}),"RotateLeftOutlined"),$e=L(e.jsx("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDown"),De=L(e.jsx("path",{d:"m7 14 5-5 5 5z"}),"ArrowDropUp"),Ae=()=>{var V,U;const Q=xe(),A=me(),m=he(),X=(V=Q.state)==null?void 0:V.controlType,[N,k]=r.useState(!1),[h,Z]=r.useState([]),[ee,se]=r.useState([]),[x,te]=r.useState([]),[ae,$]=r.useState([]),{snack:Ee,setSnack:C}=r.useContext(ge),[t,y]=r.useState({inspectionDate:_(Date()),controlType:"",inspectionType:"",inspectionReason:"",template:""}),[o,p]=r.useState({entityName:"",address:"",entityId:""}),[l,re]=r.useState(null),[g,ne]=r.useState([]),[D,O]=je.useState(null),[M,oe]=r.useState(!1),[le,G]=r.useState(!1);r.useState(!1),r.useState("");const[z,Re]=r.useState([]),[E,We]=r.useState([]),[R,ie]=r.useState([]),[W,de]=r.useState(null);r.useEffect(()=>{const s=async()=>{const a=await f({method:"get",url:`http://52.140.64.177:9090/getAllInspectionTypes/${t==null?void 0:t.controlType}`});Z(a==null?void 0:a.data)};t!=null&&t.controlType&&s()},[t==null?void 0:t.controlType]),r.useEffect(()=>{(async()=>{const a=await f.get("http://52.140.64.177:9090/getAllControlTypesForCase");ie(a==null?void 0:a.data),y({...t,controlType:X})})()},[]),r.useEffect(()=>{if(l!=null&&l.name&&(x==null?void 0:x.find(a=>a===(l==null?void 0:l.name)))){C({open:!0,message:"Entity already exists in the system.",severity:"error"});return}p({entityName:l!=null&&l.name?l==null?void 0:l.name:"",address:l!=null&&l.formatted_address?l==null?void 0:l.formatted_address:"",buildingName:"",entityArea:"",entityId:""})},[l]),r.useEffect(()=>{const s=async()=>{var v,S;const[a,d,j]=await Promise.all([f.get(`http://52.140.64.177:9090/getEntityNames/${t.inspectionType}`),f.get(`http://52.140.64.177:9090/getTemplate/${(v=h==null?void 0:h.find(c=>t.inspectionType===(c==null?void 0:c.id)))==null?void 0:v.name}`),f.get("http://52.140.64.177:9090/getForms")]);te(a==null?void 0:a.data),se(d==null?void 0:d.data),(S=d==null?void 0:d.data)==null||S.map(c=>{$(P=>[...P,`${c==null?void 0:c.template_name}: ${c==null?void 0:c.version}`])}),ne(j==null?void 0:j.data)};t.inspectionType&&s()},[t.inspectionType]);const ce=async()=>{var s,a,d,j,v;try{if(!(t!=null&&t.inspectionType)){C({open:!0,message:"Please select an inspection type.",severity:"error"});return}const S=(s=ee.find(n=>`${n.template_name}: ${n.version}`===t.template))==null?void 0:s.template_id,c=(a=h==null?void 0:h.find(n=>t.inspectionType===(n==null?void 0:n.id)))==null?void 0:a.name,P=[],K=[];g==null||g.map(n=>{z.includes(n==null?void 0:n.name)&&(n!=null&&n.id)&&P.push(n)}),E==null||E.map(n=>{z!=null&&z.includes(n)&&K.push(n)});const ue=!!W;G(!0);const b=await f.post("http://52.140.64.177:9090/startAISProcess",{inspectionType:c,reason:t.inspectionReason,dateOfInspection:_(t.inspectionDate).format("YYYY-MM-DD"),createdBy:localStorage.getItem("userEmail"),templateId:S,entityId:o.entityId,status:"new",controlTypeId:t==null?void 0:t.controlType,inspectionSource:"Adhoc",addEntity:N,newEntity:{name:(d=x==null?void 0:x.find(n=>(n==null?void 0:n.entityid)===o.entityName))==null?void 0:d.name,address:o==null?void 0:o.address,location:o==null?void 0:o.address},pre_Inspection_Checklists:P,custom_pre_inspection_checklist:K,createdDate:_(new Date).format("YYYY-MM-DD"),is_preinspection:ue,is_preinspection_submitted:!1,formId:W});((j=b==null?void 0:b.data)==null?void 0:j.status)==="Failure"?C({open:!0,message:"Something went wrong. Please try again.",severity:"error"}):((v=b==null?void 0:b.data)==null?void 0:v.status)==="Success"?C({open:!0,message:"Inspection Created successfully.",severity:"success"}):C({open:!0,message:"Unexpected response from server.",severity:"warning"}),G(!1),A("/cases")}catch(S){console.log(S),C({open:!0,message:"Something went wrong.",severity:"error"})}};r.useEffect(()=>{const s=async()=>{var d,j;const a=await f({method:"get",url:`http://52.140.64.177:9090/getAddressByEntity/${o.entityName}`});p({...o,address:(d=a==null?void 0:a.data)==null?void 0:d.address,entityId:(j=a==null?void 0:a.data)==null?void 0:j.entityId})};o.entityName&&!N&&s()},[o.entityName]);const F=s=>{oe(!M),O(M?null:s.currentTarget)};return e.jsx(e.Fragment,{children:e.jsxs(w,{sx:{borderRadius:"20px",background:`${m.palette.colors[2]} 0% 0% no-repeat padding-box`,my:2,mr:2,px:2.5,py:2,boxShadow:`inset 0px 0px 6px ${m.palette.colors[3]}`,opacity:1},children:[e.jsx(T,{sx:{color:m.palette.colors[21],fontSize:"14px",fontWeight:600},startIcon:e.jsx(pe,{}),onClick:()=>A(-1),children:"Back"}),e.jsxs(w,{sx:{background:`${m.palette.colors[1]} 0% 0% no-repeat padding-box`,borderRadius:"10px",opacity:1},children:[e.jsx(w,{sx:{py:2,px:2.5},children:e.jsx(u,{variant:"h4",fontWeight:600,children:"Create Case"})}),e.jsx(Y,{}),e.jsxs(w,{sx:{py:2,px:2.5,"& .MuiTypography-root":{fontSize:"12px",color:m.palette.colors[21]}},children:[le&&e.jsx(fe,{}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{size:4,sx:{"& .MuiInputBase-root":{height:"37px"}},children:[e.jsxs(u,{children:["Inspection Date ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(Ce,{dateAdapter:ye,children:e.jsx(Se,{size:"small",format:"DD MMM YYYY",value:t.inspectionDate,onChange:s=>{y({...t,inspectionDate:s})},className:"newCaseFields",sx:{width:"100%",height:"40px"},fullWidth:!0,required:!0})})]}),e.jsxs(i,{size:4,children:[e.jsxs(u,{children:["Control Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(q,{fullWidth:!0,className:"newCaseFields",children:e.jsx(H,{value:t.controlType,onChange:s=>{$([]),y({...t,controlType:s.target.value})},sx:{"& .MuiSelect-select":{padding:"9px 0 9px 20px"}},children:R==null?void 0:R.map(s=>e.jsx(B,{value:s==null?void 0:s.controlTypeId,children:s==null?void 0:s.controlTypeName},s==null?void 0:s.controlTypeId))})})]}),e.jsxs(i,{size:4,children:[e.jsxs(u,{children:["Inspection Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(q,{fullWidth:!0,className:"newCaseFields",children:e.jsx(H,{value:t.inspectionType,onChange:s=>{$([]),y({...t,inspectionType:s.target.value})},sx:{"& .MuiSelect-select":{padding:"9px 0 9px 20px"}},children:h==null?void 0:h.map(s=>e.jsx(B,{value:s==null?void 0:s.id,children:s==null?void 0:s.name},s==null?void 0:s.id))})})]}),e.jsxs(i,{size:4,children:[e.jsxs(u,{children:["Reason for Inspection ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(I,{size:"small",fullWidth:!0,value:t.inspectionReason,className:"newCaseFields",onChange:s=>{y({...t,inspectionReason:s.target.value})}})]}),e.jsxs(i,{size:4,children:[e.jsxs(u,{children:["Choose Template ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(J,{disablePortal:!0,id:"combo-box-demo",size:"small",options:ae,fullWidth:!0,value:t.template,className:"newCaseFields",onChange:(s,a)=>{y({...t,template:a})},renderInput:s=>e.jsx(I,{...s})})]})]}),e.jsx(Y,{sx:{my:3}}),!N&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{size:4,children:[e.jsx(u,{children:"Entity Name"}),e.jsx(J,{disablePortal:!0,id:"combo-box-demo",size:"small",className:"newCaseFields",slotProps:{paper:{component:({children:s,...a})=>e.jsxs(be,{...a,children:[e.jsx(T,{fullWidth:!0,sx:{justifyContent:"flex-start",pl:2,color:"black"},onMouseDown:()=>{k(!0),p({entityArea:"",entityName:"",buildingName:"",address:""})},startIcon:e.jsx(Ie,{}),children:"Create New"}),s]})}},value:(U=x==null?void 0:x.find(s=>(s==null?void 0:s.entityid)===o.entityName))==null?void 0:U.name,onChange:(s,a)=>{console.log(a),p({...o,entityName:a==null?void 0:a.entityid})},options:x,getOptionLabel:s=>s!=null&&s.name?s==null?void 0:s.name:"",fullWidth:!0,renderInput:s=>e.jsx(I,{...s})})]}),e.jsxs(i,{size:4,children:[e.jsx(u,{children:"Address"}),e.jsx(I,{size:"small",fullWidth:!0,value:o.address,className:"newCaseFields",onChange:s=>{p({...o,address:s.target.value})}})]})]}),N&&e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{container:!0,size:4,rowSpacing:2.5,children:[e.jsxs(i,{size:12,children:[e.jsx(u,{children:"Entity Name"}),e.jsx(I,{fullWidth:!0,size:"small",className:"newCaseFields",value:o.entityName,onChange:s=>{p({...o,entityName:s.target.value})},slotProps:{input:{endAdornment:e.jsx(e.Fragment,{children:e.jsx(ve,{onClick:F,children:M?e.jsx(De,{}):e.jsx($e,{})})})}},onClick:F})]}),e.jsxs(i,{size:12,children:[e.jsx(u,{children:"Address"}),e.jsx(I,{size:"small",fullWidth:!0,value:o.address,className:"newCaseFields",onChange:s=>{p({...o,address:s.target.value})}})]})]}),e.jsx(i,{size:8,children:e.jsx(Me,{setNewEntityAddress:re})})]}),e.jsx(Y,{sx:{my:3}}),(localStorage.getItem("userRole")==="MANAGER"||localStorage.getItem("userRole")==="INSPECTOR")&&e.jsx(e.Fragment,{children:(g==null?void 0:g.length)>0&&e.jsxs(i,{container:!0,children:[e.jsx(u,{mb:1,children:"Pre Inspection Checklist "}),e.jsx(ze,{"aria-labelledby":"demo-radio-buttons-group-label",defaultValue:"female",name:"radio-buttons-group",value:W,onChange:s=>de(s.target.value),sx:{width:"100%"},children:g==null?void 0:g.map((s,a)=>e.jsx(w,{sx:{border:`1px solid${m.palette.colors[22]}`,borderRadius:"20px",opacity:1,width:"100%",px:3,mb:.6,"& .MuiTypography-root":{color:m.palette.colors[6]}},children:e.jsx(we,{control:e.jsx(Fe,{sx:{mr:1}}),label:s==null?void 0:s.name,value:s==null?void 0:s.id})},a))})]})}),e.jsx(i,{container:!0,sx:{"& .MuiButtonBase-root:hover":{backgroundColor:m.palette.colors[11]},justifyContent:"flex-end",my:2},children:e.jsx(T,{sx:{backgroundColor:m.palette.colors[11],textTransform:"none",borderRadius:"20px",width:"100px",height:"40px"},onClick:ce,children:"Submit"})}),e.jsx(Ne,{anchorEl:D,open:M,fullWidth:!0,width:"100%",onClose:F,slotProps:{paper:{style:{width:D?D.clientWidth:void 0}}},children:e.jsxs(B,{onClick:()=>{F(),k(!1)},fullWidth:!0,width:"100%",children:[e.jsx(Pe,{}),"Select from System"]})})]})]})]})})};export{Ae as default};
