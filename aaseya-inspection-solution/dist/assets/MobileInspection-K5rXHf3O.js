import{c as $e,j as e,b as xe,r as c,S as Oe,a as pe,Q as he,J as Le,G as h,C as Ue,T as g,I as _,W as Ge,e as A,i as W,B as x,z as Me,D as z,o as L,u as Ve}from"./index-CsrR-wrF.js";import{A as He,a as Ke}from"./add-notes-m3W-_Glx.js";import{A as Je}from"./PlaylistAddOutlined-CpSMRKtR.js";import{D as Qe}from"./download-DA--uIhM.js";import{C as de}from"./Check-cGaUIAku.js";import{C as ue}from"./Close-CoWB75cj.js";/* empty css                  */import{E as qe}from"./EditOutlined-CGOMMi2k.js";import{D as Xe}from"./DeleteOutlined-BStDlczd.js";/* empty css                    */const Ye=$e(e.jsx("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6z"}),"KeyboardArrowRight"),Ze=({inspectionChecklists:f,inspectionID:a,categoryIndex:D,isShowInspectionReport:N})=>{var ce;const V=xe(),[u,P]=c.useState([]),[me,R]=c.useState({}),[j,I]=c.useState([]),[p,C]=c.useState(""),[E,T]=c.useState(""),[H,w]=c.useState(""),[U,v]=c.useState(""),d=c.useRef(0),[K,ge]=c.useState(""),[B,J]=c.useState(!1),[ke,fe]=c.useState(!1),k=c.useRef(0),$=c.useRef(0),{snack:et,setSnack:G}=c.useContext(Oe),ee=pe(),[je,F]=c.useState(!1),{isShowCategoryView:te,setIsShowCategoryView:tt}=c.useContext(he),[Q,q]=c.useState("");c.useState({});const[ne,X]=c.useState(!1),[se,Y]=c.useState(""),O=c.useRef({}),[Ie,we]=c.useState(null),be=Le("input")`
        clip: rect(0 0 0 0);
        clip-path: inset(50%);
        height: 1px;
        overflow: hidden;
        position: absolute;
        bottom: 0;
        left: 0;
        white-space: nowrap;
        width: 1px;
    `;c.useEffect(()=>{D&&(d.current=D),N&&J(N)},[D,N]),c.useEffect(()=>{P(f)},[f]),c.useEffect(()=>{var t,r;f==null||f.map(o=>{var s;k.current+=(s=o==null?void 0:o.checklistItem)==null?void 0:s.length}),R(f[d.current]),I((t=f[d.current])==null?void 0:t.checklistItem),C((r=f[d.current])==null?void 0:r.categoryName)},[f]),c.useEffect(()=>{te&&ee("/cases/categories",{state:{categoryChecklists:f,inspectionID:a}})},[te]);const Z=()=>{var t,r,o,s;R(u[d.current]),I((t=u[d.current])==null?void 0:t.checklistItem),C((r=u[d.current])==null?void 0:r.categoryName),j.length>0&&P(l=>l.map(n=>(n==null?void 0:n.categoryName)===p?{...n,checklistItem:j}:n)),J(!1),R(u[d.current]),I((o=u[d.current])==null?void 0:o.checklistItem),C((s=u[d.current])==null?void 0:s.categoryName),w(""),v("")},re=()=>{P(t=>t.map(r=>(r==null?void 0:r.categoryName)===p?{...r,checklistItem:j}:r)),R({}),I([]),C(""),w(""),v(""),J(!0)},ve=()=>{fe(!0)},_e=async(t,r)=>{const o=await Ce(t);I(s=>s.map(l=>{var n,m;return l.checklist_name===r.checklist_name?{...l,attachments:((n=l.attachments)==null?void 0:n.length)>0?[...l.attachments,t.target.files[0]]:[t.target.files[0]],attachmentsBase64:((m=l.attachmentsBase64)==null?void 0:m.length)>0?[...l.attachmentsBase64,o]:[o]}:l}))},Ce=async t=>new Promise((r,o)=>{const s=t.target.files[0];if(s){const l=new FileReader;l.onloadend=()=>{const n=l.result.replace("data:","").replace(/^.+,/,"");r(n)},l.onerror=n=>o(n),l.readAsDataURL(s)}else o("No file selected")}),ye=(t,r)=>{I(o=>o.map(s=>s.checklist_name===r.checklist_name?{...s,comment:t.target.value}:s))},Se=t=>{I(r=>r.map(o=>{var s;return o.checklist_name===t.checklist_name?{...o,selected_corrective_action:((s=o.selected_corrective_action)==null?void 0:s.length)>0?[...o.selected_corrective_action,E]:[E]}:o})),v(""),T("")},Ae=(t,r)=>{I(o=>o.map(s=>{var l;return s.checklist_name===t.checklist_name?{...s,selected_corrective_action:(l=s.selected_corrective_action)==null?void 0:l.map(n=>n===r?se:n)}:s})),X(!1),Y("")},Ne=(t,r)=>{I(o=>o.map(s=>{var l;return s.checklist_name===t.checklist_name?{...s,selected_corrective_action:(l=s.selected_corrective_action)==null?void 0:l.filter(n=>n!==r)}:s}))},Re=(t,r)=>{I(o=>o.map(s=>s.checklist_name===t.checklist_name?{...s,selected_answer:r}:s)),O.current[p]?O.current[p].includes(t==null?void 0:t.checklist_id)||(O.current[p].push(t==null?void 0:t.checklist_id),$.current=parseInt($.current)+1):(O.current[p]=[t==null?void 0:t.checklist_id],$.current=parseInt($.current)+1)},Ee=t=>{if(typeof t=="string"){const o=t.match(/^data:image\/(png|jpeg|jpg|gif|webp|bmp|svg\+xml);base64,/),s=o?`image/${o[1]}`:"image/png",l=t.replace(/^data:image\/(png|jpeg|jpg|gif|webp|bmp|svg\+xml);base64,/,""),n=atob(l),m=new Uint8Array(n.length);for(let b=0;b<n.length;b++)m[b]=n.charCodeAt(b);const y=new Blob([m],{type:s});return URL.createObjectURL(y)}return URL.createObjectURL(t)},Be=async()=>{var t;try{F(!0);let r=[];u==null||u.forEach(s=>{var l;(s==null?void 0:s.categoryName)===p?j==null||j.forEach(n=>{var m;r.push({id:{inspectionID:a,categoryID:s==null?void 0:s.categoryId,checklistID:n==null?void 0:n.checklist_id},selected_answer:n==null?void 0:n.selected_answer,attachment:(n==null?void 0:n.attachmentsBase64)||null,comment:(m=n==null?void 0:n.comment)==null?void 0:m.trim(),corrective_actions:(n==null?void 0:n.selected_corrective_action)||[]})}):(l=s==null?void 0:s.checklistItem)==null||l.forEach(n=>{var m;r.push({id:{inspectionID:a,categoryID:s==null?void 0:s.categoryId,checklistID:n==null?void 0:n.checklist_id},selected_answer:n==null?void 0:n.selected_answer,attachment:(n==null?void 0:n.attachmentsBase64)||null,comment:(m=n==null?void 0:n.comment)==null?void 0:m.trim(),corrective_actions:(n==null?void 0:n.selected_corrective_action)||[]})})});const o=await L({method:"post",url:"http://52.140.64.177:9090/saveInspection",data:{inspectionChecklistandAnswers:r,inspectorComment:K}});((t=o==null?void 0:o.data)==null?void 0:t.status)==="Failure"?G({open:!0,message:"Something went wrong. Please try again.",severity:"error"}):G({open:!0,message:"Inspection saved successfully.",severity:"success"}),F(!1)}catch(r){console.log(r),F(!1)}},Fe=async()=>{var t;try{F(!0);let r=[];u==null||u.map(s=>{var l;(l=s==null?void 0:s.checklistItem)==null||l.map(n=>{var m,y;r.push({id:{inspectionID:a,categoryID:s==null?void 0:s.categoryId,checklistID:n==null?void 0:n.checklist_id},selected_answer:n==null?void 0:n.selected_answer,attachment:(n==null?void 0:n.attachmentsBase64)||null,comment:(m=n==null?void 0:n.comment)==null?void 0:m.trim(),corrective_actions:((y=n==null?void 0:n.selected_corrective_action)==null?void 0:y.filter(b=>b!==""))||[]})})});const o=await L({method:"post",url:`http://52.140.64.177:9090/submitInspection/${a}`,data:{inspectionChecklistandAnswers:r,inspectorComment:K}});((t=o==null?void 0:o.data)==null?void 0:t.status)==="Failure"?G({open:!0,message:"Something went wrong. Please try again later.",severity:"error"}):(G({open:!0,message:"Inspection submitted successfully.",severity:"success"}),ee("/cases")),F(!1)}catch(r){console.log(r),F(!1)}},[oe,ae]=c.useState({}),We=async t=>{try{const r=await L.post("http://52.140.64.177:9090/askCopilot",{prompt:oe[t]||""});r.data.status==="SUCCESS"?q(o=>({...o,[t]:r.data.chatGPTResponse})):q(o=>({...o,[t]:"Error: Unable to fetch data"}))}catch(r){console.error("Error fetching data from API:",r),q(o=>({...o,[t]:"Error: Unable to fetch data"}))}},ze=(t,r)=>{ae(o=>({...o,[r]:t.target.value}))},De=t=>{We(t)},Pe=t=>{ae(r=>({...r,[t]:""}))},Te=(t,r)=>{t.preventDefault(),I(o=>o.map(s=>s.checklist_name===r.checklist_name?{...s,comment:Q[r.checklist_id]}:s))};return e.jsx(e.Fragment,{children:e.jsxs(h,{container:!0,children:[je&&e.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:50},children:e.jsx(h,{container:!0,sx:{justifyContent:"center",alignItems:"center","& .MuiCircularProgress-root":{color:"#00000029"}},children:e.jsx(Ue,{size:160,thickness:2,color:"grey"})})}),e.jsxs(h,{container:!0,sx:{marginTop:"48px",backgroundColor:"#F2F6F6",height:"95vh"},children:[e.jsxs(h,{container:!0,sx:{alignItems:"center",justifyContent:"center",marginLeft:"24px",width:"100%"},children:[B?e.jsxs(h,{size:8.5,children:[e.jsx(g,{fontWeight:700,children:"Inspection Report"}),e.jsxs(g,{fontWeight:500,children:["Case Progress: ",$.current,"/",k.current]})]}):e.jsxs(h,{size:8.5,children:[e.jsx(g,{fontWeight:700,children:(p==null?void 0:p.length)>25?(p==null?void 0:p.slice(0,24))+"...":p}),e.jsxs(g,{className:"typographyFontWeight",children:[(ce=O.current[p])==null?void 0:ce.length,"/",j==null?void 0:j.length," ","Completed"]})]}),e.jsxs(h,{size:3.5,container:!0,direction:"row",sx:{alignItems:"center",justifyContent:"center"},children:[e.jsx(_,{onClick:()=>{d.current>0&&(B?d.current=d.current:d.current=d.current-1,Z())},children:e.jsx(Ge,{sx:{fontSize:"30px",color:d.current>0?"#4C8B92":"#B5B5B5"}})}),e.jsx(_,{onClick:()=>{d.current<(u==null?void 0:u.length)-1?(d.current=d.current+1,Z()):re()},children:e.jsx(Ye,{sx:{fontSize:"30px",color:B?"#B5B5B5":"#4C8B92"}})})]})]}),e.jsxs(h,{container:!0,className:"mobileCategoryChecklistContainer",sx:{paddingBottom:"30px"},children:[j==null?void 0:j.map((t,r)=>{var o,s,l,n,m,y,b,le;return e.jsx(e.Fragment,{children:e.jsxs(h,{container:!0,children:[e.jsx(h,{size:12,sx:{fontSize:"14px"},mb:1,mt:1,children:e.jsx(g,{className:"typographyFontWeight",children:t.checklist_name})}),e.jsx(h,{container:!0,size:12,direction:"column",rowGap:1,sx:{justifyContent:"space-between"},children:(s=(o=t==null?void 0:t.pre_defined_answer_type)==null?void 0:o.split("/"))==null?void 0:s.map((i,S)=>e.jsx(A,{variant:"outlined",className:"mobileChoiceButton",sx:{backgroundColor:(t==null?void 0:t.selected_answer)===i?V.palette.colors[20]:"",fontWeight:(t==null?void 0:t.answer)===i?700:""},onClick:()=>Re(t,i),children:i},i+S))}),(localStorage.getItem("userRole")==="INSPECTOR"||localStorage.getItem("userRole")==="REVIEWER")&&e.jsxs(h,{container:!0,size:12,sx:{pt:2},direction:"column",children:[e.jsx(g,{className:"typographyFontWeight",children:"Co-Pilot"}),e.jsx(W,{placeholder:"Ask Anything",size:"small",className:"multilineInput",value:oe[t.checklist_id]||"",onChange:i=>ze(i,t.checklist_id),fullWidth:!0}),e.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",gap:1,".MuiButtonBase-root":{border:"1px solid #EBEBEB",backgroundColor:"#EBEBEB",borderRadius:"6px",color:"#00060A",px:3}},children:[e.jsx(A,{onClick:()=>Pe(t.checklist_id),children:"Clear"}),e.jsx(A,{onClick:()=>De(t.checklist_id),children:"Ask Co-Pilot"})]}),e.jsx(g,{className:"typographyFontWeight",children:"Answer"}),e.jsx(W,{placeholder:"Answer",size:"small",className:"multilineInput",value:Q[t.checklist_id]||"",slotProps:{input:{readOnly:!0}},fullWidth:!0,multiline:!0,rows:4}),Q[t.checklist_id]&&e.jsx(x,{sx:{textAlign:"right",marginTop:"-10px",padding:"8px 0",position:"relative",top:"0",right:"14px"},children:e.jsx(Me,{href:"#",onClick:i=>{w(`note${t.checklist_id}`),Te(i,t)},sx:{color:"blue"},children:"Add to Notes"})})]}),e.jsx(z,{sx:{my:1,width:"100%"}}),localStorage.getItem("userRole")==="INSPECTOR"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{className:"mobileAttachmentContainer",display:"flex",children:[e.jsx(x,{className:"attchmentsContainer",children:e.jsxs(A,{component:"label",role:void 0,tabIndex:-1,sx:{fontWeight:500,color:"black",fontSize:14},startIcon:e.jsx(He,{sx:{fontSize:12}}),children:[e.jsx(be,{type:"file",accept:"image/*",onChange:i=>{_e(i,t)}}),"Attach Image"]})}),e.jsxs(x,{className:"attchmentsContainer",onClick:()=>{w(`note${t.checklist_id}`)},children:[e.jsx("img",{src:Ke,alt:"Add notes"}),e.jsx(g,{ml:1,className:"typographyFontWeight",children:"Add Notes"})]}),e.jsxs(x,{className:"attchmentsContainer",onClick:()=>{v(`correctiveAction${t.checklist_id}`)},children:[e.jsx(Je,{sx:{mr:1}}),e.jsx(g,{className:"typographyFontWeight",children:"Add Corrective Actions"})]})]}),e.jsx(z,{sx:{my:1,width:"100%"}})]}),((l=t==null?void 0:t.attachments)==null?void 0:l.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[e.jsx(g,{className:"headingFontWeight",children:"Documents"}),e.jsx(x,{className:"mobileAttachmentContainer",children:(n=t==null?void 0:t.attachments)==null?void 0:n.map((i,S)=>{var M,ie;return e.jsxs(x,{className:"attachmentItems",columnGap:6,children:[e.jsxs(x,{className:"imageContainer",children:[e.jsx("img",{src:Ee(i),alt:i.name,className:"attchmentImage"}),e.jsx(g,{className:"attachmentTextStyle",children:((M=i.name)==null?void 0:M.length)>15?((ie=i.name)==null?void 0:ie.slice(0,14))+"...":i.name})]}),e.jsx(x,{className:"imageDownload",children:e.jsx("img",{src:Qe,alt:"Download"})})]},S)})})]}),e.jsx(z,{sx:{my:1,width:"100%"}})]}),((t==null?void 0:t.comment)||H===`note${t.checklist_id}`)&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{width:"100%",children:[e.jsx(g,{className:"headingFontWeight",children:"Note"}),e.jsx(W,{size:"small",fullWidth:!0,disabled:localStorage.getItem("userRole")!=="INSPECTOR",rows:2,className:"multilineInput",multiline:!0,value:t==null?void 0:t.comment,onChange:i=>ye(i,t)})]}),e.jsx(z,{sx:{my:1,width:"100%"}})]}),U===`correctiveAction${t.checklist_id}`&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{width:"100%",children:[e.jsx(g,{className:"headingFontWeight",children:"Corrective Actions"}),e.jsx(x,{className:"correctiveActionContainer",children:e.jsx(W,{size:"small",fullWidth:!0,className:"correctiveActionField",value:E,onChange:i=>T(i.target.value)})}),e.jsxs(x,{className:"iconContainer",children:[e.jsx(_,{onClick:()=>v(""),children:e.jsx(ue,{sx:{color:"#d54b4b",fontWeight:"bold"}})}),e.jsx(_,{onClick:()=>Se(t),children:e.jsx(de,{sx:{color:"#03911a",fontWeight:"bold"}})})]})]}),e.jsx(z,{sx:{mt:1,mb:3,width:"100%"}})]}),((y=(m=t==null?void 0:t.selected_corrective_action)==null?void 0:m.filter(i=>i!==""))==null?void 0:y.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{width:"100%",children:[e.jsx(g,{className:"headingFontWeight",children:"Corrective Actions"}),(le=(b=t==null?void 0:t.selected_corrective_action)==null?void 0:b.filter(i=>i!==""))==null?void 0:le.map((i,S)=>e.jsx(x,{className:"correctiveActions",children:ne&&S===Ie?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsx(W,{size:"small",fullWidth:!0,className:"correctiveActionField",value:se,onChange:M=>Y(M.target.value)}),e.jsxs(x,{className:"iconContainer",children:[e.jsx(_,{onClick:()=>X(!1),children:e.jsx(ue,{sx:{color:"#d54b4b",fontWeight:"bold"}})}),e.jsx(_,{onClick:()=>{Ae(t,i)},children:e.jsx(de,{sx:{color:"#03911a",fontWeight:"bold"}})})]})]}):e.jsxs(x,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(g,{className:"typographyFontWeight",children:i}),e.jsxs(x,{children:[e.jsx(_,{onClick:()=>{ne||(we(S),X(!0),Y(i))},children:e.jsx(qe,{sx:{color:"#03911a",fontWeight:"bold"}})}),e.jsx(_,{onClick:()=>Ne(t,i),children:e.jsx(Xe,{sx:{color:"#d54b4b",fontWeight:"bold"}})})]})]})},S))]}),e.jsx(z,{sx:{mt:1,mb:3,width:"100%"}})]})]},t.checklist_id)})}),B&&e.jsx(h,{size:12,sx:{py:2,height:"65vh"},container:!0,children:e.jsx(h,{container:!0,size:12,children:e.jsx(W,{size:"small",fullWidth:!0,disabled:localStorage.getItem("userRole")!=="INSPECTOR",rows:5,className:"multilineInput",multiline:!0,value:K,onChange:t=>ge(t.target.value)})})}),e.jsxs(h,{container:!0,size:12,direction:"row",sx:{padding:"16px 0",alignItems:"flex-end",p:2,pb:5},children:[e.jsx(h,{size:12,sx:{mt:1},children:e.jsx(A,{variant:"outlined",className:"mobileSaveButton",onClick:Be,children:"Save"})}),!B&&e.jsx(h,{size:12,sx:{mt:1,width:"100%"},children:e.jsx(A,{className:"mobileNextSubmitButton",onClick:()=>{d.current<(u==null?void 0:u.length)-1?(d.current=d.current+1,Z()):localStorage.getItem("userRole")==="INSPECTOR"?re():localStorage.getItem("userRole")==="APPROVER"&&ve()},children:"Next"})}),B&&e.jsxs(h,{size:12,sx:{mt:1,width:"100%"},children:[" ",e.jsx(A,{className:"mobileNextSubmitButton",onClick:()=>{Fe()},children:"Submit"})]})]})]})]})]})})},xt=()=>{var p,C,E,T;xe();const f=Ve(),a=(p=f.state)==null?void 0:p.caseDetails,[D,N]=c.useState([]);pe();const V=(C=f.state)==null?void 0:C.categoryIndex,u=(E=f.state)==null?void 0:E.inspectionID,P=(T=f.state)==null?void 0:T.isShowInspectionReport,{header:me,setHeader:R}=c.useContext(he),[j,I]=c.useState(!0);return c.useEffect(()=>{R(a!=null&&a.inspectionID?`Case ID ${a==null?void 0:a.inspectionID}`:`Case ID ${u}`)},[]),c.useEffect(()=>{const H=async()=>{var U,v;const w=await L({method:"get",url:`http://52.140.64.177:9090/getSubmittedInspection/${a!=null&&a.inspectionID?a==null?void 0:a.inspectionID:u}`});if(((U=Object.keys(w==null?void 0:w.data))==null?void 0:U.length)>0)N((v=w==null?void 0:w.data)==null?void 0:v.checklist);else{const d=await L({method:"get",url:`http://52.140.64.177:9090/getInspectionChecklist/${a!=null&&a.inspectionID?a==null?void 0:a.inspectionID:u}`});N(d==null?void 0:d.data)}I(!1)};(a!=null&&a.inspectionID||u)&&H()},[a==null?void 0:a.inspectionID,u]),j?e.jsx(e.Fragment,{children:e.jsx(x,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"85vh"},children:e.jsx(g,{variant:"h4",children:"Loading..."})})}):e.jsx(e.Fragment,{children:e.jsx(x,{children:e.jsx(Ze,{inspectionChecklists:D,inspectionID:a!=null&&a.inspectionID?a==null?void 0:a.inspectionID:u,categoryIndex:V,isShowInspectionReport:P})})})};export{xt as default};
